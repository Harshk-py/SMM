generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * Clean, consistent schema for The Next Funnel
 * - All primary keys use String + cuid()
 * - Relations are defined clearly
 * - Models: ContactMessage, User, Plan, Order
 */

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  message   String   @db.Text
  planId    String?  // optional reference to plan slug or id
  createdAt DateTime @default(now())
  processed Boolean  @default(false)

  @@index([email])
  @@index([planId])
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())

  // relations
  orders Order[] // a user can have many orders
}

model Plan {
  id        String   @id @default(cuid())
  slug      String   @unique
  title     String
  usdPrice  Int
  createdAt DateTime @default(now())

  // relations
  orders Order[]
}

model Order {
  id         String   @id @default(cuid())
  provider   String   // "paypal" or "stripe"
  providerId String?  // PayPal orderId / Stripe paymentIntent id
  amount     Float
  currency   String
  status     String
  planId     String?
  userId     String?
  createdAt  DateTime @default(now())

  // relation fields
  plan Plan? @relation(fields: [planId], references: [id])
  user User? @relation(fields: [userId], references: [id])

  @@index([planId])
  @@index([userId])
}
